!function(a){var b=function(a,b){this.init(a,b)},c=null;b.prototype={init:function(b,c){this.$table=a(b),this.$thead=this.$table.find("thead"),this.$tbody=this.$table.find("tbody"),this.$tfoot=this.$table.find("tfoot");var d=this;this.$table.dragTable(),this.$table.stupidtable({date:function(a,b){var c=new Date(a.replace(/-/g,"/")),d=new Date(b.replace(/-/g,"/"));return c-d},moveBlanks:function(a,b){return b>a?""==a?1:-1:a>b?""==b?-1:1:0},moveBlanksDesc:function(a,b){return b>a?1:a>b?-1:0}}),this.$table.on("aftertablesort",function(b,c){var e,f,d=a(this).find("th");d.find(".arrow").remove(),e=a.fn.stupidtable.dir,f=c.direction===e.ASC?"&uarr;":"&darr;",d.eq(c.column).append('<span class="arrow">'+f+"</span>")}),this.$thead.find("input[type='checkbox']").change(function(){var b=a(this).is(":checked");d.$tbody.find("input[type='checkbox']").each(function(){a(this).prop("checked",b)})}),this.setOptions(c)},setOptions:function(b){var c,d,e,f;if(this.options=a.extend({},this.options||a.fn.tableList.defaults,b),this.$table.tableScroll(this.options.height,this.options.cutHeight),c=1,Boolean(this.options.url)){if(Boolean(this.options.searchForm)&&(d=JSON.parse(window.sessionStorage.getItem(window.location.href+"_searchParams")),Boolean(d))){window.sessionStorage.removeItem(window.location.href+"_searchParams");for(key in d)a(this.options.searchForm+" input[data-key='"+key+"']").val(d[key]),a(this.options.searchForm+" select[data-key='"+key+"']").find("option[value='"+d[key]+"']").attr("selected",!0);d=a(this.options.searchForm).serialize(),e=this,f=!1,d.split("&").forEach(function(a){return e.options.param.indexOf(a.split("=")[0])>-1?(f=!0,void 0):void 0}),f?this.options.param=a(this.options.searchForm).serialize():this.options.param+="&"+a(this.options.searchForm).serialize()}c=window.sessionStorage.getItem(window.location.href+"_currentPage"),Boolean(c)?window.sessionStorage.removeItem(window.location.href+"_currentPage"):c=1}this.options.paging&&(e=this,this.page_options={size:"small",alignment:"left",currentPage:c,totalPages:1,itemContainerClass:function(a,b,c){return b===c?"active":"pointer-cursor"},onPageClicked:function(a,b,c,d){e.$thead.find("th span.arrow").remove(),e.page_options.currentPage=d>=e.page_options.totalPages?e.page_options.totalPages:d,e.page_param="&page.startIndex="+(e.page_options.currentPage-1)*e.options.pageSize,e.page_param+="&page.pageSize="+e.options.pageSize,e.initTableList()}},this.page_param="&page.startIndex="+(this.page_options.currentPage-1)*this.options.pageSize,this.page_param+="&page.pageSize="+this.options.pageSize),this.initTableList()},initTableList:function(){var b,c;Boolean(this.options.url)&&(b=this,this.$thead.find("input[type='checkbox']").prop("checked",!1),this.$tbody.empty(),this.$tfoot.find("td").html("&nbsp;"),this.dataList=null,c=this.options.param,this.options.paging&&(c+=this.page_param),a.post(this.options.url,c,function(c){var d,e;if(b.options.paging){if(d=c[b.options.dataKey],b.dataList=d.records,0==b.dataList.length&&b.page_options.currentPage>1)return b.page_options.currentPage--,b.page_param="&page.startIndex="+(b.page_options.currentPage-1)*b.options.pageSize,b.page_param+="&page.pageSize="+b.options.pageSize,b.initTableList(),void 0;b.page_options.totalPages=0==d.totalCount%b.options.pageSize?Math.floor(d.totalCount/b.options.pageSize):Math.floor(d.totalCount/b.options.pageSize)+1,b.page_options.totalPages>1?(b.$tfoot.find("td").attr("style","text-align:"+b.page_options.alignment+";padding-left:15px"),b.$tfoot.find("td").bootstrapPaginator(b.page_options)):b.$tfoot.find("td").html("&nbsp;")}else b.dataList=c[b.options.dataKey];b.$tbody.empty(),e="",Boolean(b.dataList)&&b.dataList.length>0?a.each(b.dataList,function(a){"function"==typeof b.options.template&&(e+=b.options.paging?b.options.template(a,this,(b.page_options.currentPage-1)*b.options.pageSize+a+1):b.options.template(a,this))}):e+='<tr><td colspan="'+b.$thead.find("th").length+'">'+tip_message.no_data+"</td></tr>",b.$tbody.append(e),a(".alt").tooltip({html:!0,placement:"bottom"}),b.$tbody.find("input[type='checkbox']").change(function(){b.$tbody.find("input[type='checkbox']").length==b.$tbody.find("input[type='checkbox']:checked").length?b.$thead.find("input[type='checkbox']").prop("checked",!0):b.$thead.find("input[type='checkbox']").prop("checked",!1)}),"function"==typeof b.options.finishCallBack&&b.options.finishCallBack(b.dataList)}))},refresh:function(){this.initTableList()},search:function(a){this.options.paging&&(this.page_options.currentPage=1),this.setOptions(a)},initTableListByData:function(b){var c=this;this.$thead.find("input[type='checkbox']").prop("checked",!1),this.$tbody.empty(),this.dataList=b,a.each(this.dataList,function(a){"function"==typeof c.options.template&&c.$tbody.append(c.options.template(a,this))}),a(".alt").tooltip({placement:"bottom"}),this.$tbody.find("input[type='checkbox']").change(function(){c.$tbody.find("input[type='checkbox']").length==c.$tbody.find("input[type='checkbox']:checked").length?c.$thead.find("input[type='checkbox']").prop("checked",!0):c.$thead.find("input[type='checkbox']").prop("checked",!1)}),"function"==typeof c.options.finishCallBack&&c.options.finishCallBack(c.dataList)},saveSearchParams:function(){if(Boolean(this.options.searchForm)){var b={};a(this.options.searchForm+" input,"+this.options.searchForm+" select").each(function(){b[a(this).attr("data-key")]=a(this).val()}),window.sessionStorage.setItem(window.location.href+"_searchParams",JSON.stringify(b))}window.sessionStorage.setItem(window.location.href+"_currentPage",this.page_options.currentPage)}},c=a.fn.tableList,a.fn.tableList=function(c){var d=null;return a(this).each(function(e,f){var g=a(f),h=g.data("tableList"),i="object"!=typeof c?null:c;h?h.setOptions(i):g.data("tableList",h=new b(this,i)),d=h}),d},a.fn.tableList.defaults={height:0,cutHeight:70,url:"",param:"",dataKey:"data",finishCallBack:function(){},template:function(){},paging:!1,pageSize:30,searchForm:""}}(jQuery);